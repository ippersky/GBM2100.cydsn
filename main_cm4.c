/******************************************************************************
* File Name: main_cm4.c
*
* Version: 1.2
*
* Description: This file main application code for the CE223727 EmWin Graphics
*				library EInk Display 

********************************************************************************
*************MODIFIED by Christophe Cloutier-Tremblay.**************************
********************************************************************************
* 
*
* Hardware Dependency: CY8CKIT-028-EPD E-Ink Display Shield
*					   CY8CKIT-062-BLE PSoC6 BLE Pioneer Kit
*
******************************************************************************* 
* Copyright (2019), Cypress Semiconductor Corporation. All rights reserved. 
******************************************************************************* 
* This software, including source code, documentation and related materials 
* (“Software”), is owned by Cypress Semiconductor Corporation or one of its 
* subsidiaries (“Cypress”) and is protected by and subject to worldwide patent 
* protection (United States and foreign), United States copyright laws and 
* international treaty provisions. Therefore, you may use this Software only 
* as provided in the license agreement accompanying the software package from 
* which you obtained this Software (“EULA”). 
* 
* If no EULA applies, Cypress hereby grants you a personal, non-exclusive, 
* non-transferable license to copy, modify, and compile the Software source 
* code solely for use in connection with Cypress’s integrated circuit products. 
* Any reproduction, modification, translation, compilation, or representation 
* of this Software except as specified above is prohibited without the express 
* written permission of Cypress. 
* 
* Disclaimer: THIS SOFTWARE IS PROVIDED AS-IS, WITH NO WARRANTY OF ANY KIND, 
* EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, NONINFRINGEMENT, IMPLIED 
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. Cypress 
* reserves the right to make changes to the Software without notice. Cypress 
* does not assume any liability arising out of the application or use of the 
* Software or any product or circuit described in the Software. Cypress does 
* not authorize its products for use in any products where a malfunction or 
* failure of the Cypress product may reasonably be expected to result in 
* significant property damage, injury or death (“High Risk Product”). By 
* including Cypress’s product in a High Risk Product, the manufacturer of such 
* system or application assumes all risk of such use and in doing so agrees to 
* indemnify Cypress against all liability.
********************************************************************************/
//allo

#include "project.h"
#include "GUI.h"
#include "pervasive_eink_hardware_driver.h"
#include "cy_eink_library.h"
#include "LCDConf.h"
#include <stdlib.h>
#include <arm_math.h>
#include <core_cm4.h>
#include <algorithme.h>

//vecteur sinus de 150 élément entre -1 et 1
float vectorSinus[]={0.099833,0.29552,0.47943,0.64422,0.78333,0.89121,0.96356,0.99749,0.99166,0.9463,0.86321,0.74571,0.59847,0.42738,0.23925,0.041581,-0.15775,-0.35078,-0.52984,-0.68777,-0.81828,-0.91617,-0.97753,-0.99992,-0.98245,-0.92581,-0.83227,-0.70554,-0.55069,-0.37388,-0.18216,0.016814,0.21512,0.40485,0.57844,0.72897,0.85044,0.938,0.98817,0.99894,0.96989,0.90217,0.79849,0.66297,0.50102,0.3191,0.12445,-0.075151,-0.27176,-0.45754,-0.62507,-0.76769,-0.8797,-0.95664,-0.99544,-0.99455,-0.95402,-0.87545,-0.76198,-0.61814,-0.44965,-0.26323,-0.066322,0.13323,0.32747,0.50866,0.66957,0.80378,0.90595,0.97201,0.99931,0.98677,0.9349,0.84575,0.72288,0.5712,0.39674,0.20647,0.0079632,-0.19086,-0.38207,-0.55805,-0.71179,-0.83714,-0.92912,-0.98407,-0.99977,-0.97563,-0.91258,-0.81316,-0.68131,-0.52231,-0.34248,-0.149,0.050423,0.24783,0.43537,0.60554,0.75157,0.86764,0.94912,0.99277,0.99683,0.96115,0.88716,0.77779,0.63742,0.47164,0.28705,0.091022,-0.10864,-0.30396,-0.48717,-0.65096,-0.7888,-0.89519,-0.96589,-0.99808,-0.99049,-0.9434,-0.85871,-0.73978,-0.59136,-0.41936,-0.23065};

/* Image buffer cache */
uint8 imageBufferCache[CY_EINK_FRAME_SIZE] = {0};

/*******************************************************************************
* Function Name: void UpdateDisplay(void)
********************************************************************************
*
* Summary: This function updates the display with the data in the display 
*			buffer.  The function first transfers the content of the EmWin
*			display buffer to the primary EInk display buffer.  Then it calls
*			the Cy_EINK_ShowFrame function to update the display, and then
*			it copies the EmWin display buffer to the Eink display cache buffer
*
* Parameters:
*  None
*
* Return:
*  None
*
* Side Effects:
*  It takes about a second to refresh the display.  This is a blocking function
*  and only returns after the display refresh
*
*******************************************************************************/
void UpdateDisplay(cy_eink_update_t updateMethod, bool powerCycle)
{
    cy_eink_frame_t* pEmwinBuffer;

    /* Get the pointer to Emwin's display buffer */
    pEmwinBuffer = (cy_eink_frame_t*)LCD_GetDisplayBuffer();

    /* Update the EInk display */
    Cy_EINK_ShowFrame(imageBufferCache, pEmwinBuffer, updateMethod, powerCycle);

    /* Copy the EmWin display buffer to the imageBuffer cache*/
    memcpy(imageBufferCache, pEmwinBuffer, CY_EINK_FRAME_SIZE);
}


/*******************************************************************************
* Function Name: void ClearScreen(void)
********************************************************************************
*
* Summary: This function clears the screen
*
* Parameters:
*  None
*
* Return:
*  None
*
*******************************************************************************/
void ClearScreen(void)
{
    GUI_SetColor(GUI_BLACK);
    GUI_SetBkColor(GUI_WHITE);
    GUI_Clear();
    UpdateDisplay(CY_EINK_FULL_4STAGE, true);
}
/*******************************************************************************
* Function Name: void WaitforSwitchPressAndRelease(void)
********************************************************************************
*
* Summary: This implements a simple "Wait for button press and release"
*			function.  It first waits for the button to be pressed and then
*			waits for the button to be released.
*
* Parameters:
*  None
*
* Return:
*  None
*
* Side Effects:
*  This is a blocking function and exits only on a button press and release
*
*******************************************************************************/
void WaitforSwitchPressAndRelease(void)
{
    /* Wait for SW2 to be pressed */
    while(Status_SW2_Read() != 0);
    
    /* Wait for SW2 to be released */
    while(Status_SW2_Read() == 0);
}

/*******************************************************************************
* Function Name: int main(void)
********************************************************************************
*
* Summary: À Remplir
*
* Parameters:
*  None
*
* Return:
*  None
*
*******************************************************************************/
int main(void)
{
 
    SystemeInit();
    SystemeCoreClockUpdate();
    __enable_irq(); /* Enable global interrupts. */
    
    //test frequence cardiaque
   
    uint32_t signalRouge[] = {205973,207305,206168,208001,206188,208050,206371,208225,206544,208577,206719,208501,206990,208473,207183,208417,207367,208379,207724,208151,207986,207993,208303,207802,208682,207622,208730,207587,209365,207455,209209,207541,209337,207549,209635,207806,209501,207957,209461,207996,209317,208103,209140,208491,209000,208672,208748,209006,208491,209357,208350,209326,208242,209947,208089,209826,208216,210028,208306,210395,208429,210203,208596,210292,208686,210169,208954,210055,209354,209987,209644,209821,210027,209660,210440,209483,210556,209554,211304,209484,211253,209696,211585,209817,211970,210011,211842,210178,211772,209972,211207,209606,210230,208954,209085,208043,207710,207263,206266,206439,205001,205392,203820,204970,202756,203955,202073,203512,201459,203377,201194,202759,200993,202713,201002,202459,201198,202302,201513,202188,201835,202108,202327,202081,202824,201965,203003,202176,203932,202267,203918,202500,204436,202777,204921,203032,204880,203312,205157,203520,205057,203810,205034,204221,204997,204527,204912,204994,204917,205416,204837,205671,204732,206338,204657,206251,204614,206460,204591,206662,204581,206367,204586,206402,204548,205967,204548,205683,204576,205312,204550,204995,204844,204647,205035,204328,205121,204143,205709,203943,205474,203995,205910,204074,206112,204207,205943,204379,206337,204543,206193,204879,206211,205289,206165,205581,206150,206104,206141,206566,206010,206910,206113,207618,206076,207602,206252,208240,206424,208563,206665,208406,206886,208919,207081,208835,207367,208762,207638,208729,207896,208526,208348,208387,208732,208203,209019,208070,209391,207916,209311,207900,209782,207913,209978,208038,209863,208165,210137,208232,209963,208477,209827,208599,209678,208829,209472,209224,209399,209521,209079,209731,208932,210161,208772,210177,208810,210728,208819,210815,208995,210858,209138,211288,209319,211079,209575,211060,209773,210901,209995,210738,210439,210645,210706,210529,211089,210404,211618,210365,211667,210429,212263,210423,212435,210609,212498,210811,212917,210990,212716,211242,212775,211454,212706,211741,212553,212006,212075,211822,211394,211512,210369,211017,209260,210003,208265,209523,207043,208474,206230,207583,205368,207020,204742,206069,204125,205441,203797,204749,203574,204319,203623,203937,203726,203711,204060,203522,204535,203455,204648,203514,205413,203600,205487,203925,205838,204139,206355,204422,206331,204765,206340,204905,206310,205237,206250,205671,206162,205966,205968,206378,205974,206914,205810,207094,205989,207848,206030,207872,206243,208126,206361,208540,206469,208161,206571,208104,206495,207865,206553,207469,206683,207157,206675,206745,206985,206432,207161,205979,207035,205823,207540,205630,207319,205637,207490,205725,207795,205872,207640,206063,207704,206191,207660,206451,207570,206852,207480,207082,207399,207523,207226,207973,207110,208152,207223,208946,207143,208810,207353,209287,207568,209686,207753,209513,208047,209837,208178,209768,208528,209740,208807,209638,209102,209523,209624,209366,210012,209201,210201,209221,210869,209090,210717,209231,211127,209364,211505,209471,211253,209641,211502,209749,211284,210005,211154,210212,210911,210296,210704,210713,210535,211061,210301,211173,210189,211774,210039,211600,210189,212038,210190,212362,210297,212096,210407,212316,210475,212075,210711,211948,210956,211803,211212,211653,211541,211458,211950,211297,212162,211147,212676,211065,212538,211107,213028,211128,213309,211291,213136,211550,213521,211655,213358,211962,213213,212192,213126,212324,212892,212745,212641,212897,212237,212817,211647,212736,210700,211734,209874,211225,208833,210424,207895,209190,207005,208490,206174,207482,205680,206645,205094,205800,204742,205171,204714,204613,204625,204101,204717,203793,205149,203572,205005,203696,205554,203726,205828,203942,205803,204307,206380,204622,206388,205060,206559,205421,206533,205667,206535,206180,206481,206490,206292,206883,206160,207464,206115,207521,206292,208305,206402,208474,206687,208511,206872,208939,206992,208721,207152,208503,207163,208264,207233,207947,207416,207560,207525,207132,207592,206828,207877,206444,207676,206334,208139,206136,207901,206112,207857,206140,208169,206238,207931,206358,207820,206447,207713,206638,207466,206977,207303,207277,207192,207706,207081,208103,206973,208188,207054,208950,207122,209005,207357,209176,207559,209677,207752,209623,208115,209711,208280,209649,208588,209549,208922,209296,209159,209208,209510,209029,209986,208906,210092,208903,210711,208890,210682,209036,210928,209164,211335,209311,211094,211720,211030,209525,210907,209785,210764,210028,210524,210284,210345,210516,210097,210907,209864,211006,209891,211597,209748,211450,209870,211707,209890,212048,209987,211765,210127,211854,210201,211623,210469,211470,210733,211316,210888,211118,211196,210930,211603,210667,211690,210606,212342,210484,212189,210579,212483,210694,212799,210842,212573,211019,212804,211122,212648,211327,212545,211738,212381,211884,212207,212313,211997,212555,211697,212417,211130,212474,210392,211663,209582,210986,208536,210186,207596,208845,206687,208006,205810,206859,205077,205887,204565,204967,204035,204126,203888,203512,203845,202960,203738,202628,204118,202439,203935,202488,204343,202575,204707,202795,204640,203013,205052,203336,204937,203668,204977,204040,204969,204330,204876,204830,204776,205237,204682,205516,204642,206110,204556,206120,204730,206553,204767,206984,205086,206843,205306,207283,205514,207187,205758,207073,206036,206817,205965,206536,206288,206252,206480,205757,206476,205521,206800,205189,206481,205014,206753,204868,206842,204892,206576,204847,206794,204864,206512,204991,206368,205193,206259,205479,206067,205917,206011,206185,205832,206505,205736,207049,205641,207054,205744,207677,205808,207841,205975,207873,206220,208307,206433,208201,206816,208156,206957,208166,207280,207951,207650,207851,207951,207751,208318,207524,208751,207360,208732,207447,209377,207486,209448,207647,209547,207845,209949,208064,209884,208361,209769,208443,209677,208653,209502,209006,209346,209267,209108,209543,208882,209991,208717,209936,208778,210564,208710,210582,208885,210665,208980,211015,209119,210898,209304,210890,209478,210768,209613,210563,209998,210388,210286,210144,210565,210008,210988,209826,210946,209720,211636,209803,211609,209905,211789,210059,212260,210340,212156,210567,212254,210845,212192,211165,212252,211804,212405,212285,212545,212971,212673,213594,212600,213848,212870,214737,212927,214762,213232,215114,213355,215520,213428,214996,213115,214297,212290,213075,211348,211815,210476,210447,209470,209150,208748,207828,208024,206645,207233,205750,207023,204975,206291,204508,206021,204099,205998,204007,205585,204018,205645,204029,205451,204382,205460,204681,205400,205052,205435,205558,205352,206132,205385,206300,205392,207043,205377,206977,205572,207429,205698,207808,205855,207670,206112,207954,206217,207802,206579,207710,206838,207691,207156,207571,207659,207520,208121,207396,208164,207266,208831,207087,208549,207031,208881,206937,209011,206953,208672,206911,208749,206875,208359,207002,208077,207039,207916,207137,207549,207435,207421,207762,207153,207883,206938,208370,206767,208281,206806,208691,206879,209003,207025,208899,207248,209205,207450,209142,207859,209183,208127,209079,208435,209097,208956,209060,209330,208949,209665,208937,210337,208907,210282,208999,210922,209103,211227,209338,211130,209514,211507,209658,211335,210007,211406,210233,211292,210431,211158,210899,211008,211142,210843,211401,210703,211921,210519,211929,210622,212543,210619,212650,210787,212677,211015,213014,211109,212831,211328,212760,211424,212555,211620,212399,211935,212254,212274,211988,212548,211878,213045,211792,213058,211872,213695,211836,213723,212023,213764,212107,214141,212207,213976,212444,213978,212561,213814,212790,213647,213178,213433,213256,213236,213604,213053,214014,212777,214017,212791,214711,212831,214578,212869,214713,212951,215001,213085,214904,213336,214919,213394,214810,213726,214644,214049,214470,214286,214324,214636,214209,215145,214101,215181,214071,215853,213998,215681,213838,215485,213293,215090,212519,213685,211537,212532,210401,211138,209377,209833,208543,208539,207685,207409,207149,206377,206738,205485,206224,204936,206446,204573,206047,204375,206176,204424,206479,204602,206362,204832,206582,205086,206582,205453,206639,205975,206652,206324,206671,206854,206659,207364,206592,207587,206567,208249,206427,208131,206597,208464,206690,208855,206886,208685,207100,208901,207246,208807,207586,208842,207884,208682,208174,208461,208493,208255,208718,207938,208709,207708,209237,207422,208843,207305,209017,207199,209180,207173,208804,207184,208929,207156,208590,207211,208372,207326,208081,207446,207828,207730,207568,208010,207394,208229,207376,208914,207267,208852,207462,209415,207626,209828,207884,209782,208185,210224,208454,210135,208761,210155,209042,210094,209318,210018,209933,209885,210267,209844,210517,209760,211191,209687,211122,209773,211691,209903,212042,210077,211879,210259,212317,210487,212149,210723,212088,210956,212022,211161,211833,211530,211570,211805,211356,211991,211245,212537,211050,212419,211078,212864,211076,213031,211100,212893,211208,213321,211333,213013,211522,212924,211664,212821,211782,212580,212210,212421,212557,212263,212785,212103,213256,211960,213182,211992,213805,211943,213844,212051,213864,212166,214285,212379,214111,212508,214014,212672,213962,212946,213827,213460,213680,213660,213558,213989,213480,214473,213322,214552,213344,215280,213397,215275,213497,215459,213670,215880,213931,215746,214098,215724,214345,215598,214609,215625,215011,215457,215304,215352,215709,215283,216244,215123,216231,215130,216874,214883,216468,214563,215995,213800,215293,212737,213910,211664,212684,210510,211312,209563,209969,208745,208814,208081,207718,207573,206864,207345,206068,206926,205681,207246,205302,206824,205216,207047,205225,207331,205362,207116,205594,207333,205807,207362,206210,207378,206656,207463,207070,207459,207711,207451,208230,207425,208404,207467,209224,207499,209213,207718,209570,207820,210056,208154,210027,208442,210338,208698,210256,209077,210331,209369,210185,209613,209892,209940,209606,210080,209341,210116,209065,210550,208668,210225,208634,210317,208468,210433,208342,210038,208295,210098,208233,209763,208423,209621,208540,209371,208619,209076,208953,208888,209265,208629,209450,208539,210092,208490,210045,208661,210640,208911,211025,209083,210978,209386,211439,209661,211392,210066,211405,210387,211467,210717,211426,211309,211488,211796,211364,212165,211405,212846,211485,212873,211601,213537,211674,213829,211926,213746,212102,214174,212330,213994,212605,213965,212814,213902,213002,213744,213548,213694,213844,213552,214293,213690,214977,213663,215124,213983,215928,214090,216232,214397,216245,214620,216655,214751,216466,214953,216397,215115,216241,215278,216089,215675,215943,215997,215766,216268,215676,216750,215479,216761,215624,217475,215542,217554,215782,217616,215906,217952,216038,217764,216190,217682,216324,217608,216550,217483,216981,217434,217306,217164,217698,217146,218207,217011,218309,217239,219040,217251,219250,217556,219513,217808,219950,217933,219730,218074,219488,217810,218742,217109,217496,216259,216004,215083,214466,214073,212973,213169,211526,212062,210438,211711,209519,210806,208914,210456,208465,210356,208162,209771,208139,209547,207970,209310,208104,209156,208523,209032,208719,208956,209132,208905,209721,208934,210086,209034,210874,209255,211101,209690,211586,209998,212207,210360,212266,210711,212535,211071,212588,211434,212584,211774,212539,212199,212496,212618,212417,213181,212364,212284,212284,213954,212118,213698,212075,213882,211945,214019,211855,213578,211823,213589,211687,213098,211666,212774,211673,212372,211642,211920,211812,211536,212042,211263,212083,211017,212505,210810,212251,210816,212707,210974,213000,211027,212799,211223,213170,211418,213043,211712,213052,212049,212943,212323,212942,212837,212858,213359,212828,213630,212769,214305,212836,214360,213014,214951,213119,215377,213404,215318,213604,215647,213791,215480,214097,215454,214377,215421,214622,215209,215049,215102,215321,214885,215642,214826,216221,214731,216134,214833,216724,214759,216880,214951,216793,215138,217103,215192,216850,215364,216805,215471,216544,215611,216390,216092,216161,216246,215938,216571,215787,217018,215635,216935,215716,217579,215724,217632,215832,217661,215948,218073,216189,217908,216401,217869,216535,217748,216789,217525,217112,217373,217387,217138,217712,217053,218135,216881,218123,217022,218904,217006,219002,217291,219108,217397,219398,217403,219014,217107,218172,216289,216992,215304,215485,214362,214073,213269,212585,212389,211296,211660,210043,210764,209127,210560,208376,209838,207857,209458,207583,209507,207396,209058,207381,208949,207468,208827,207705,208769,208167,208676,208437,208693,208944,208758,209624,208799,209882,208948,210689,208986,210861,209345,211269,209619,211815,209978,211771,210289,212074,210554,212034,210920,212150,211446,212070,211826,212122,212312,212030,212779,211899,212817,211817,213364,211522,213078,211481,213231,211339,213369,211220,212830,211168,212836,210991,212383,210933,212030,210962,211597,210977,211265,211283,210959,211441,210688,211500,210504,212082,210360,211916,210450,212289,210473,212681,210706,212539,210859,212792,211129,212718,211463,212780,211866,212758,212165,212666,212718,212743,213237,212693,213577,212745,214292,212759,214371,212984,214896,213041,215328,213344,215232,213622,215621,213828,215459,214199,215450,214450,215375,214703,215227,215146,215208,215497,215031,215733,214856,216313,214759,216179,214785,216701,214751,216831,214841,216681,214972,216970,215036,216679,215191,216530,215280,216330,215437,216140,215849,215922,216060,215728,216313,215500,216766,215327,216654,215360,217194,215224,217217,215377,217133,215494,217497,215505,217298,215747,217183,215940,217067,216078,216916,216469,216764,216749,216588,217196,216506,217736,216372,217677,216431,218347,216483,218371,216596,218360,216547,218451,216141,217572,215456,216333,214360,214952,213269,213478,212320,212074,211361,210693,210465,209459,209929,208312,209067,207543,209031,206887,208356,206560,208090,206294,208259,206215,207994,206385,207925,206506,207889,206781,207887,207368,207916,207730,207894,208272,207905,208853,207949,209073,208098,209817,208197,209953,208407,210262,208625,210743,208891,210642,209177,210799,209343,210800,209675,210759,210093,210717,210381,210651,210741,210433,211191,210244,211047,209937,211661,209672,211245,209597,211313,209492,211533,209430,211045,209426,211117,209348,210817,209432,210564,209524,210177,209597,209838,209839,209556,210090,209293,210209,209238,210826,209124,210684,209224,211068,209304,211466,209523,211407,209795,211724,210056,211762,210468,211730,210829,211726,211135,211739,211773,211687,212171,211583,212521,211643,213193,211607,213159,211762,213635,211817,214022,212143,213898,212315,214204,212484,214079,212737,214077,212928,213880,213098,213758,213574,213537,213789,213288,213962,213132,214569,212944,214384,213037,214836,212992,215058,213062,214816,213164,215178,213236,214892,213450,214793,213637,214638,213778,214461,214207,214363,214497,214134,214707,213977,215248,213848,215256,213869,215777,213883,215927,214103,215905,214216,216366,214430,216184,214726,216078,214808,216040,215086,215932,215494,215811,215772,215584,216106,215564,216695,215396,216702,215537,217446,215604,217552,215760,217529,215802,217737,215560,217006,214922,215827,};
    uint32_t longueur = sizeof(signalRouge);

    //uint32_t BPM = HeartRate(&signalRouge,0,1000);
    
    
    
    /* Initialize emWin Graphics */
    GUI_Init();

    /* Start the eInk display interface and turn on the display power
    Cy_EINK_Start(20);
    Cy_EINK_Power(1);
    
    GUI_SetPenSize(1);
    GUI_SetColor(GUI_BLACK);
    GUI_SetBkColor(GUI_WHITE);
    GUI_Clear();
    
    //Draw a rectangle
    GUI_DrawRect(1,1,263,175);
    
    //Draw a line
    GUI_SetPenSize(4);
    GUI_DrawLine(20,65,243,65);
    
    GUI_SetColor(GUI_BLACK);
    GUI_SetBkColor(GUI_WHITE);
    
   //Write a title and subtile	
    GUI_SetFont(GUI_FONT_32B_1);
    GUI_SetTextAlign(GUI_TA_CENTER);
    GUI_DispStringAt("GBM2100", 132, 30);
    GUI_SetFont(GUI_FONT_16_1);
    GUI_DispStringAt("Laboratoire 3", 132, 70);
    
    UpdateDisplay(CY_EINK_FULL_4STAGE, true);
    
    */
    
    for(;;)
    {
        
    }
}

/* [] END OF FILE */
